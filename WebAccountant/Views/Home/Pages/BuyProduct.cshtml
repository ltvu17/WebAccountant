@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    Html.RenderPartial("../Home/Header");
}
<div class="text-center">
    <div class="home-container">
        @Html.Partial("../Home/SideBar")
        <div class="right-bar-home content">
            <form>
                @(Html.DevExtreme().DataGrid<WebAccountant.Models.KtdmDTO>()
                    .DataSource(ds => ds.Mvc()
                    .Controller("Ktdms")
                    .LoadAction("GetDto")
                    .UpdateAction("UpdateDto")
                    .Key("Madm", "Matk")
                    )
                    .RemoteOperations(true)
                    .FocusedRowEnabled(true)
                    .Columns(columns =>
                    {

                        columns.AddFor(m => m.Matk).AllowEditing(false);

                        columns.AddFor(m => m.Madm).AllowEditing(false);

                        columns.AddFor(m => m.Tendm).AllowEditing(false).Width(500);

                        columns.AddFor(m => m.Donvi).AllowEditing(false);

                        columns.AddFor(m => m.Soluong).AllowEditing(true).Alignment(HorizontalAlignment.Left);

                    }).ColumnAutoWidth(true).AllowColumnResizing(true).ColumnResizingMode(ColumnResizingMode.Widget).FilterRow(ft => ft.Visible(true))
                    .ShowBorders(true)
                    .RowAlternationEnabled(true)
                    .Editing(editing =>
                    {
                        editing.Mode(GridEditMode.Batch);
                        editing.AllowUpdating(true);
                        editing.SelectTextOnEditStart(true);
                        editing.StartEditAction(GridStartEditAction.Click);
                    })
                    .Selection(s => s.Mode(SelectionMode.Multiple))
                    .Paging(paging => paging.PageSize(10))
                    .Pager(pager =>
                    {
                        pager.Visible(true);
                        pager.DisplayMode(GridPagerDisplayMode.Compact);
                        pager.ShowPageSizeSelector(true);
                        pager.AllowedPageSizes(new JS("[10, 20, 30]"));
                        pager.ShowInfo(true);
                        pager.ShowNavigationButtons(true);
                    }).OnSelectionChanged("selection_changed").ID("grid-container").OnRowUpdated("Updated")
                    )
                @* <a asp-controller="Home" asp-action="ExportBuyProduct"><button type="button" onclick="Submit()">Mua sản phẩm</button></a> *@
                
                <div class="buttons">
                    <button class="btn btn-success" id="saveButton" onclick="Submit()" type="button">Mua sản phẩm</button>
                </div>
            </form>

            <script type="text/javascript">
                var data = [];
                var element;
                function getDataGridInstance() {
                    let element = $("#grid-container");
                    return DevExpress.ui.dxDataGrid.getInstance(element);
                }
                async function save() {
                    $("#grid-container div [role='button']")[0].click();
                    // $("#saveButton").after(`<button type="button" onclick="Submit()">Mua sản phẩm</button>`)
                }

                async function selection_changed(selectedItems) {
                    var dataGrid = getDataGridInstance();
                    data = selectedItems.selectedRowsData;
                }
                function Submit() {
                    console.log(data)
                    setTimeout(function (value) {
                        $.ajax({
                            url: '@Url.Action("SubmitCartToExport", "Ktdms")',
                            type: 'POST',
                            data: JSON.stringify(data),
                            success: function (result) {
                                console.log(result)
                                //window.location.replace("/Home/ExportBuyProduct")
                                window.open("https://localhost:7278/InvoiceReport/HoaDon.pdf", "_blank");
                            }
                        });
                    }, 1000)
                    save().then(
                    )
                }
                function Updated() {

                }

            </script>
        </div>
    </div>
</div>


